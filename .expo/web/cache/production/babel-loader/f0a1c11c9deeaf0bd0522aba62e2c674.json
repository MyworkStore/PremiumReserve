{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";import _inherits from\"@babel/runtime/helpers/inherits\";import*as WebBrowser from'expo-web-browser';import React from'react';import Image from\"react-native-web/dist/exports/Image\";import ScrollView from\"react-native-web/dist/exports/ScrollView\";import StyleSheet from\"react-native-web/dist/exports/StyleSheet\";import Text from\"react-native-web/dist/exports/Text\";import TouchableOpacity from\"react-native-web/dist/exports/TouchableOpacity\";import View from\"react-native-web/dist/exports/View\";import Keyboard from\"react-native-web/dist/exports/Keyboard\";import Alert from\"react-native-web/dist/exports/Alert\";import{Ionicons}from'@expo/vector-icons';import OrderHistoryCard from\"../components/OrderHistoryCard\";import FirebaseHelper from\"../helper/FireBaseHelper\";import{getLongCurrentTime}from\"../components/CommonFunction\";import ImageSelectTag from\"../components/ImageSelectTag\";import Constants from'expo-constants';import*as DocumentPicker from'expo-document-picker';import{Notifications}from'expo';import*as Permissions from'expo-permissions';var HistoryDetailScreen=function(_React$Component){_inherits(HistoryDetailScreen,_React$Component);function HistoryDetailScreen(props){var _this;_classCallCheck(this,HistoryDetailScreen);_this=_possibleConstructorReturn(this,_getPrototypeOf(HistoryDetailScreen).call(this,props));_this._picker=function _callee(){var result;return _regeneratorRuntime.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return _regeneratorRuntime.awrap(DocumentPicker.getDocumentAsync({type:'image/*',copyToCacheDirectory:false}));case 2:result=_context.sent;_this.setState({uriUpload:result.uri});case 4:case\"end\":return _context.stop();}}});};_this.onUpdate=function(val){_this.setState({uriUpload:val});};_this.getToken=function _callee2(node,key){var _ref,existingStatus,finalStatus,_ref2,status;return _regeneratorRuntime.async(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_this.setState({loadToken:true});_context2.next=3;return _regeneratorRuntime.awrap(Permissions.getAsync(Permissions.NOTIFICATIONS));case 3:_ref=_context2.sent;existingStatus=_ref.status;finalStatus=existingStatus;if(!(existingStatus!=='granted')){_context2.next=12;break;}_context2.next=9;return _regeneratorRuntime.awrap(Permissions.askAsync(Permissions.NOTIFICATIONS));case 9:_ref2=_context2.sent;status=_ref2.status;finalStatus=status;case 12:if(!(finalStatus!=='granted')){_context2.next=14;break;}return _context2.abrupt(\"return\");case 14:_context2.t0=FirebaseHelper;_context2.t1=node;_context2.t2=key;_context2.next=19;return _regeneratorRuntime.awrap(Notifications.getExpoPushTokenAsync());case 19:_context2.t3=_context2.sent;_context2.t4={token:_context2.t3};_context2.t0.updateData.call(_context2.t0,_context2.t1,_context2.t2,_context2.t4);case 22:case\"end\":return _context2.stop();}}});};_this.sendMessage=function(token){Keyboard.dismiss();var response=fetch('https://exp.host/--/api/v2/push/send',{method:'POST',header:{Accept:'application/json','Content-Type':'application/json'},body:JSON.stringify({to:token,sound:'default',title:'ข้อความแจ้งเตือน',body:\"มีคำสั่งซื่อเข้ามาในระบบ\"})});};_this.uploadData=function(){if(_this.state.uriUpload==null){Alert.alert(\"แจ้งเตือน!!\",\"กรุณาเลือกรูป All memeber Barcode\",[{text:'ตกลง'}]);}else{var navigation=_this.props.navigation;var userid=navigation.getParam('userid','NO-orderStatusMsg');var orderDetail=navigation.getParam('orderDetail','NO-orderStatusMsg');getLongCurrentTime().then(function(time){FirebaseHelper.updateData(\"tb_user/\",\"user-\"+userid+\"/order-\"+orderDetail.order_no+\"/\",{booking_timestamp:time,allmem_barcode_pic:orderDetail.order_no+\".PNG\",order_status:\"K\"});_this.insertTransToStore(time,userid,orderDetail);});FirebaseHelper.uploadImageAllmem(orderDetail.order_no+\".PNG\",_this.state.uriUpload);}};_this.state={orderDetail:[],uriUpload:null,loadToken:false,token:\"\",message:\"\"};return _this;}_createClass(HistoryDetailScreen,[{key:\"componentWillMount\",value:function componentWillMount(){console.log('############### AAAAAAAAAAAA ################');}},{key:\"render\",value:function render(){var navigation=this.props.navigation;return React.createElement(View,null,React.createElement(ScrollView,null,React.createElement(View,null,React.createElement(OrderHistoryCard,{orderDetail:navigation.getParam('orderDetail','NO-orderStatusMsg')})),this.showDetail()));}},{key:\"insertTransToStore\",value:function insertTransToStore(time,userid,orderDetail){var _this2=this;FirebaseHelper.queryDataObjII(\"tb_product_master/\"+orderDetail.product_code).then(function(data){var order={order_no:orderDetail.order_no,booking_timestamp:time,confirm:\"N\",pic:data.val().pic,product_name:data.val().product_name,transaction_url:\"tb_user/user-\"+userid+\"/order-\"+orderDetail.order_no};FirebaseHelper.writeUserData(\"store-00005/\",\"transaction/\"+orderDetail.order_no,order).then(function(){_this2.props.navigation.navigate(\"History\");});_this2.getToken(\"store-00005/\",\"transaction/\"+orderDetail.order_no);_this2.sendMessage(\"ExponentPushToken[-IHQ6NO89P9Nyz-HK8wNyB]\");});}},{key:\"showDetail\",value:function showDetail(){var _this3=this;var navigation=this.props.navigation;var orderDetail=navigation.getParam('orderDetail','NO-orderStatusMsg');switch(orderDetail.order_status){case\"U\":case\"R\":return React.createElement(View,null,React.createElement(View,{style:styles.containerReason},React.createElement(Text,{style:styles.fontReasonDetail},\"\\u0E2B\\u0E21\\u0E32\\u0E22\\u0E40\\u0E2B\\u0E15\\u0E38*\"),React.createElement(Text,{style:styles.fontReasonDetail},orderDetail.reason_reject)),React.createElement(View,{style:styles.container},React.createElement(View,{style:[styles.containerInner,{alignItems:'center'}]},React.createElement(ImageSelectTag,{uriUpload:this.state.uriUpload,onUpdate:this.onUpdate})),React.createElement(View,{style:{justifyContent:'center',alignItems:'center'}},React.createElement(TouchableOpacity,{style:styles.button,onPress:function onPress(){return _this3.uploadData();}},React.createElement(Text,{style:styles.fontButton},\" \\u0E22\\u0E37\\u0E19\\u0E22\\u0E31\\u0E19Barcode \")))));break;case\"K\":return React.createElement(View,{style:styles.container},React.createElement(Image,{resizeMode:\"contain\",style:{width:'100%',height:'100%',backgroundColor:'transparent'},source:{uri:this.state.urlImage}}));break;case\"C\":FirebaseHelper.queryFileStorage(\"/eslip/\"+orderDetail.invoice_pic).then(function(image){_this3.setState({urlImage:image});});return React.createElement(View,{style:styles.container},React.createElement(Image,{resizeMode:\"contain\",style:{width:'100%',height:'100%',backgroundColor:'transparent'},source:{uri:this.state.urlImage}}));break;default:return React.createElement(View,{style:styles.container},React.createElement(Image,{resizeMode:\"contain\",style:{width:'100%',height:'100%',backgroundColor:'transparent'},source:{uri:this.state.urlImage}}));}}}]);return HistoryDetailScreen;}(React.Component);export{HistoryDetailScreen as default};HistoryDetailScreen.navigationOptions={title:'รายละเอียดการสั่งจอง'};var styles=StyleSheet.create({container:{justifyContent:'center',height:250,marginTop:10,marginLeft:10,marginRight:10,borderRadius:10,backgroundColor:'#f6f6f6'},containerInner:{justifyContent:'center',height:200,marginTop:10,marginLeft:10,marginRight:10,borderRadius:10,backgroundColor:'white'},containerReason:{justifyContent:'center',height:50,marginTop:10,marginLeft:10,marginRight:10,borderRadius:10,backgroundColor:'#f6f6f6'},contentLayout:{padding:5},iconLayout:{justifyContent:'center',alignItems:'center',padding:20},fontHeaderError:{fontFamily:'kanit-bold',color:'red'},fontButton:{fontFamily:'kanit-bold',color:'white'},button:{alignItems:'center',width:'50%',backgroundColor:'#F7A221',borderRadius:5,padding:10},fontHeaderWarnning:{fontFamily:'kanit-bold',color:'#D1CE05'},fontHeaderSuccess:{fontFamily:'kanit-bold',color:'green'},fontHeaderInfo:{fontFamily:'kanit-bold',color:'blue'},fontDetailI:{fontFamily:'kanit'},fontDetailII:{fontFamily:'kanit',fontSize:10,color:'#7d7d7d'},fontReason:{fontFamily:'kanit-bold',color:'blue',fontSize:12},fontReasonDetail:{fontFamily:'kanit-bold',fontSize:12}});","map":{"version":3,"sources":["D:/GitProject/PremiumReserve/screens/HistoryDetailScreen.js"],"names":["WebBrowser","React","Ionicons","OrderHistoryCard","FirebaseHelper","getLongCurrentTime","ImageSelectTag","Constants","DocumentPicker","Notifications","Permissions","HistoryDetailScreen","props","_picker","getDocumentAsync","type","copyToCacheDirectory","result","setState","uriUpload","uri","onUpdate","val","getToken","node","key","loadToken","getAsync","NOTIFICATIONS","existingStatus","status","finalStatus","askAsync","getExpoPushTokenAsync","token","updateData","sendMessage","Keyboard","dismiss","response","fetch","method","header","Accept","body","JSON","stringify","to","sound","title","uploadData","state","Alert","alert","text","navigation","userid","getParam","orderDetail","then","time","order_no","booking_timestamp","allmem_barcode_pic","order_status","insertTransToStore","uploadImageAllmem","message","console","log","showDetail","queryDataObjII","product_code","data","order","confirm","pic","product_name","transaction_url","writeUserData","navigate","styles","containerReason","fontReasonDetail","reason_reject","container","containerInner","alignItems","justifyContent","button","fontButton","width","height","backgroundColor","urlImage","queryFileStorage","invoice_pic","image","Component","navigationOptions","StyleSheet","create","marginTop","marginLeft","marginRight","borderRadius","contentLayout","padding","iconLayout","fontHeaderError","fontFamily","color","fontHeaderWarnning","fontHeaderSuccess","fontHeaderInfo","fontDetailI","fontDetailII","fontSize","fontReason"],"mappings":"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","sourcesContent":["import * as WebBrowser from 'expo-web-browser';\r\nimport React from 'react';\r\nimport {\r\n  Image,\r\n  ScrollView,\r\n  StyleSheet,\r\n  Text,\r\n  TouchableOpacity,\r\n  View,\r\n  Keyboard,\r\n  Alert,\r\n} from 'react-native';\r\nimport { Ionicons } from '@expo/vector-icons';\r\nimport OrderHistoryCard from '../components/OrderHistoryCard';\r\n//import  UploadImage  from '../components/UploadImage';\r\nimport FirebaseHelper from '../helper/FireBaseHelper';\r\nimport { getLongCurrentTime } from '../components/CommonFunction'\r\nimport ImageSelectTag from '../components/ImageSelectTag'\r\nimport Constants from 'expo-constants';\r\nimport * as DocumentPicker from 'expo-document-picker';\r\n//import * as DocumentPicker from 'expo-image-picker';\r\nimport { Notifications } from 'expo';\r\nimport * as Permissions from 'expo-permissions';\r\n\r\nexport default class HistoryDetailScreen extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      orderDetail: [],\r\n      uriUpload: null,\r\n      loadToken: false,\r\n      token: \"\",\r\n      message: \"\",\r\n\r\n    }\r\n\r\n  }\r\n\r\n  componentWillMount() {\r\n    //const { navigation } = this.props;     \r\n    //this.state = {\r\n    //  orderDetail:navigation.getParam('orderDetail', 'NO-orderStatusMsg')\r\n    //  }\r\n    console.log('############### AAAAAAAAAAAA ################');\r\n  }\r\n\r\n  _picker = async () => {\r\n    let result = await DocumentPicker.getDocumentAsync({\r\n      type: 'image/*',\r\n      copyToCacheDirectory: false\r\n    });\r\n    this.setState({\r\n      uriUpload: result.uri\r\n    });\r\n\r\n  }\r\n\r\n\r\n  render() {\r\n    // const { navigation } = this.props;\r\n    const { navigation } = this.props;\r\n    return (\r\n      <View>\r\n        <ScrollView>\r\n          <View >\r\n            <OrderHistoryCard\r\n              orderDetail={navigation.getParam('orderDetail', 'NO-orderStatusMsg')}\r\n            />\r\n          </View>\r\n\r\n          {this.showDetail()}\r\n\r\n        </ScrollView>\r\n      </View>\r\n    );\r\n  }\r\n  insertTransToStore(time, userid, orderDetail) {\r\n    FirebaseHelper.queryDataObjII(\"tb_product_master/\" + orderDetail.product_code)\r\n      .then(data => {\r\n        let order = {\r\n          order_no: orderDetail.order_no,\r\n          booking_timestamp: time,\r\n          confirm: \"N\",\r\n          pic: data.val().pic,\r\n          product_name: data.val().product_name,\r\n          transaction_url: \"tb_user/user-\" + userid + \"/order-\" + orderDetail.order_no\r\n        }\r\n        FirebaseHelper.writeUserData(\"store-00005/\", \"transaction/\" + orderDetail.order_no, order)\r\n          .then(() => {\r\n            this.props.navigation.navigate(\"History\")\r\n          })\r\n        this.getToken(\"store-00005/\", \"transaction/\" + orderDetail.order_no);\r\n        this.sendMessage(\"ExponentPushToken[-IHQ6NO89P9Nyz-HK8wNyB]\");        \r\n      });\r\n  }\r\n  onUpdate = (val) => {\r\n    this.setState({\r\n      uriUpload: val\r\n    })\r\n  };\r\n\r\n  getToken = async (node, key) => {\r\n    this.setState({\r\n      loadToken: true\r\n    })\r\n    const { status: existingStatus } = await Permissions.getAsync(\r\n      Permissions.NOTIFICATIONS\r\n    );\r\n    let finalStatus = existingStatus;\r\n\r\n    if (existingStatus !== 'granted') {\r\n      const { status } = await Permissions.askAsync(Permissions.NOTIFICATIONS);\r\n      finalStatus = status;\r\n    }\r\n\r\n    if (finalStatus !== 'granted') {     \r\n      return;\r\n    }\r\n    FirebaseHelper.updateData(node, key, {token:await Notifications.getExpoPushTokenAsync()})    \r\n  }\r\n  sendMessage = (token) => {\r\n    Keyboard.dismiss()\r\n    let response = fetch('https://exp.host/--/api/v2/push/send', {\r\n      method: 'POST',\r\n      header: {\r\n        Accept: 'application/json',\r\n        'Content-Type': 'application/json'\r\n      },\r\n      body: JSON.stringify({\r\n        to: token,        \r\n        sound: 'default',\r\n        title: 'ข้อความแจ้งเตือน',\r\n        body: \"มีคำสั่งซื่อเข้ามาในระบบ\"      \r\n      })\r\n    })\r\n  }\r\n\r\n  uploadData = () => {\r\n\r\n    if (this.state.uriUpload == null) {\r\n      Alert.alert(\"แจ้งเตือน!!\", \"กรุณาเลือกรูป All memeber Barcode\", [{ text: 'ตกลง' }]);\r\n    }\r\n    else {\r\n      const { navigation } = this.props;\r\n      const userid = navigation.getParam('userid', 'NO-orderStatusMsg');\r\n      const orderDetail = navigation.getParam('orderDetail', 'NO-orderStatusMsg');\r\n      //console.log('############### AAAAAAAAAAAA ################');   \r\n      //console.log(userid); \r\n      getLongCurrentTime().then((time) => {\r\n        FirebaseHelper.updateData(\"tb_user/\", \"user-\" + userid + \"/order-\" + orderDetail.order_no + \"/\", {\r\n          booking_timestamp: time,\r\n          allmem_barcode_pic: orderDetail.order_no + \".PNG\",\r\n          order_status: \"K\"\r\n        });\r\n        this.insertTransToStore(time, userid, orderDetail);\r\n      });\r\n      FirebaseHelper.uploadImageAllmem(orderDetail.order_no + \".PNG\", this.state.uriUpload);\r\n\r\n    }\r\n\r\n    // console.log(\"user-\"+userid+\"/order-\"+orderDetail.order_no);\r\n    //FirebaseHelper.updateData(\"tb_user\",\"user-0635162877/order-0976560\",)\r\n  }\r\n\r\n\r\n  showDetail() {\r\n\r\n    const { navigation } = this.props;\r\n    const orderDetail = navigation.getParam('orderDetail', 'NO-orderStatusMsg');\r\n    //console.log(orderDetail);\r\n    // console.log(orderDetail.order_status);\r\n    switch (orderDetail.order_status) {\r\n      case \"U\":\r\n      case \"R\":\r\n        // code block\r\n        return (\r\n          <View>\r\n            <View style={styles.containerReason}>\r\n              <Text style={styles.fontReasonDetail}>หมายเหตุ*</Text>\r\n              <Text style={styles.fontReasonDetail}>{orderDetail.reason_reject}</Text>\r\n            </View>\r\n            <View style={styles.container}>\r\n              <View style={[styles.containerInner, { alignItems: 'center' }]}>\r\n\r\n                <ImageSelectTag uriUpload={this.state.uriUpload}\r\n                  onUpdate={this.onUpdate}\r\n                />\r\n\r\n              </View>\r\n              <View style={{ justifyContent: 'center', alignItems: 'center' }}>\r\n                <TouchableOpacity\r\n                  style={styles.button}\r\n                  onPress={() => this.uploadData()}>\r\n                  <Text style={styles.fontButton} > ยืนยันBarcode </Text>\r\n                </TouchableOpacity>\r\n              </View>\r\n            </View>\r\n          </View>\r\n        );\r\n        break;\r\n      case \"K\":\r\n        return (\r\n\r\n          <View style={styles.container}>\r\n            <Image\r\n              resizeMode='contain'\r\n              style={{ width: '100%', height: '100%', backgroundColor: 'transparent' }}\r\n              source={{ uri: this.state.urlImage }}\r\n            ></Image>\r\n          </View>\r\n\r\n        );\r\n        break;\r\n      case \"C\":\r\n        //console.log(\"############# C-CASE ##############\")\r\n        FirebaseHelper.queryFileStorage(\"/eslip/\" + orderDetail.invoice_pic).then((image) => {\r\n          this.setState({\r\n            urlImage: image,\r\n          })\r\n        })\r\n        return (\r\n\r\n          <View style={styles.container}>\r\n            <Image\r\n              resizeMode='contain'\r\n              style={{ width: '100%', height: '100%', backgroundColor: 'transparent' }}\r\n              source={{ uri: this.state.urlImage }}\r\n            ></Image>\r\n          </View>\r\n\r\n        );\r\n        break;\r\n      default:\r\n        return (\r\n          <View style={styles.container}>\r\n            <Image\r\n              resizeMode='contain'\r\n              style={{ width: '100%', height: '100%', backgroundColor: 'transparent' }}\r\n              source={{ uri: this.state.urlImage }}\r\n            ></Image>\r\n          </View>\r\n\r\n        );\r\n    }\r\n  }\r\n}\r\n\r\nHistoryDetailScreen.navigationOptions = {\r\n  title: 'รายละเอียดการสั่งจอง'\r\n  //headerLeft: null\r\n  // header: null,\r\n  // tabBarVisible: false\r\n};\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    justifyContent: 'center',\r\n    height: 250,\r\n    marginTop: 10,\r\n    marginLeft: 10,\r\n    marginRight: 10,\r\n    borderRadius: 10,\r\n    //borderWidth:0.25,\r\n    //elevation:10,       \r\n    backgroundColor: '#f6f6f6'\r\n  },\r\n  containerInner: {\r\n    justifyContent: 'center',\r\n    height: 200,\r\n    marginTop: 10,\r\n    marginLeft: 10,\r\n    marginRight: 10,\r\n    borderRadius: 10,\r\n    //borderWidth:0.25,\r\n    //elevation:10,       \r\n    backgroundColor: 'white'\r\n\r\n  },\r\n  containerReason: {\r\n    justifyContent: 'center',\r\n    height: 50,\r\n    marginTop: 10,\r\n    marginLeft: 10,\r\n    marginRight: 10,\r\n    borderRadius: 10,\r\n    //borderWidth:0.25,\r\n    //elevation:10,       \r\n    backgroundColor: '#f6f6f6'\r\n\r\n  },\r\n  contentLayout: {\r\n    padding: 5,\r\n  },\r\n  iconLayout: {\r\n    justifyContent: 'center',\r\n    alignItems: 'center',\r\n    padding: 20\r\n  },\r\n  fontHeaderError: {\r\n    fontFamily: 'kanit-bold',\r\n    color: 'red'\r\n  },\r\n  fontButton: {\r\n    fontFamily: 'kanit-bold',\r\n    color: 'white'\r\n  },\r\n  button: {\r\n    alignItems: 'center',\r\n    width: '50%',\r\n    backgroundColor: '#F7A221',\r\n    borderRadius: 5,\r\n    padding: 10\r\n  }\r\n  ,\r\n  fontHeaderWarnning: {\r\n    fontFamily: 'kanit-bold',\r\n    color: '#D1CE05'\r\n  }\r\n  ,\r\n  fontHeaderSuccess: {\r\n    fontFamily: 'kanit-bold',\r\n    color: 'green'\r\n  },\r\n  fontHeaderInfo: {\r\n    fontFamily: 'kanit-bold',\r\n    color: 'blue'\r\n  },\r\n  fontDetailI: {\r\n    fontFamily: 'kanit'\r\n\r\n  }\r\n  ,\r\n  fontDetailII: {\r\n    fontFamily: 'kanit',\r\n    fontSize: 10,\r\n    color: '#7d7d7d'\r\n\r\n  }\r\n  , fontReason:\r\n  {\r\n    fontFamily: 'kanit-bold',\r\n    color: 'blue',\r\n    fontSize: 12\r\n  }\r\n  , fontReasonDetail:\r\n  {\r\n    fontFamily: 'kanit-bold',\r\n    fontSize: 12\r\n  }\r\n});"]},"metadata":{},"sourceType":"module"}