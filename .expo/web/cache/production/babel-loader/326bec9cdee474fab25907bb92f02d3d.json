{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";import _inherits from\"@babel/runtime/helpers/inherits\";import*as WebBrowser from'expo-web-browser';import React from'react';import Image from\"react-native-web/dist/exports/Image\";import Platform from\"react-native-web/dist/exports/Platform\";import ScrollView from\"react-native-web/dist/exports/ScrollView\";import StyleSheet from\"react-native-web/dist/exports/StyleSheet\";import Text from\"react-native-web/dist/exports/Text\";import TouchableOpacity from\"react-native-web/dist/exports/TouchableOpacity\";import TouchableHighlight from\"react-native-web/dist/exports/TouchableHighlight\";import View from\"react-native-web/dist/exports/View\";import AsyncStorage from\"react-native-web/dist/exports/AsyncStorage\";import FlatList from\"react-native-web/dist/exports/FlatList\";import OrderHistoryCard from\"../components/OrderHistoryCard\";import Lookup from\"../helper/Lookup\";import FirebaseHelper from\"../helper/FireBaseHelper\";import KeepAwake from'expo-keep-awake';import{resolve}from'uri-js';import{getLongCurrentTime}from\"../components/CommonFunction\";var HistoryScreen=function(_React$Component){_inherits(HistoryScreen,_React$Component);function HistoryScreen(props){var _this;_classCallCheck(this,HistoryScreen);_this=_possibleConstructorReturn(this,_getPrototypeOf(HistoryScreen).call(this,props));_this._render=function(item){return React.createElement(TouchableHighlight,{onPress:function onPress(){return _this.props.navigation.navigate(\"HistoryDetail\",{orderDetail:item.item,userid:_this.state.userid});}},React.createElement(OrderHistoryCard,{orderDetail:item.item}));};_this.state={orderDtl:[],userid:''};AsyncStorage.setItem('userid','0635162877');return _this;}_createClass(HistoryScreen,[{key:\"getOrder\",value:function getOrder(table,orderByField){var _this2=this;FirebaseHelper.listenerData(table,function(data){_this2.getOrderData(data);});}},{key:\"getOrderData\",value:function getOrderData(dataWait){var _this3=this;var result=[];var data=dataWait.val();var promiseArr=Object.keys(data).map(function(key,index){return new Promise(function(resolve){resolve(result.push({allmem_barcode_pic:data[key].allmem_barcode_pic,booking_by:data[key].booking_by,booking_qty:data[key].booking_qty,booking_timestamp:data[key].booking_timestamp,booking_value:data[key].booking_value,confirm_timestamp:data[key].confirm_timestamp,firstname:data[key].firstname,invoice_pic:data[key].invoice_pic,lastname:data[key].lastname,notification_flag:data[key].notification_flag,order_status:data[key].order_status,order_no:data[key].order_no,phone:data[key].phone,product_code:data[key].product_code,reason_reject:data[key].reason_reject}));});});Promise.all(promiseArr).then(function(){_this3.setState({orderDtl:result});});}},{key:\"componentDidMount\",value:function componentDidMount(){var userid;return _regeneratorRuntime.async(function componentDidMount$(_context){while(1){switch(_context.prev=_context.next){case 0:userid='';_context.next=3;return _regeneratorRuntime.awrap(AsyncStorage.getItem('userid'));case 3:userid=_context.sent;this.getOrder('tb_user/user-'+userid,\"booking_timestamp\");this.setState({userid:userid});case 6:case\"end\":return _context.stop();}}},null,this);}},{key:\"render\",value:function render(){return React.createElement(View,null,React.createElement(FlatList,{data:this.state.orderDtl,renderItem:this._render}));}}]);return HistoryScreen;}(React.Component);export{HistoryScreen as default};HistoryScreen.navigationOptions={title:'ประวัติ'};var styles=StyleSheet.create({container:{height:105,flexDirection:'row',marginTop:10,marginLeft:10,marginRight:10,borderRadius:5},contentLayout:{flex:8,padding:5},iconLayout:{justifyContent:'center',alignItems:'center',padding:20}});","map":{"version":3,"sources":["D:/GitProject/PremiumReserve/screens/HistoryScreen.js"],"names":["WebBrowser","React","OrderHistoryCard","Lookup","FirebaseHelper","KeepAwake","resolve","getLongCurrentTime","HistoryScreen","props","_render","item","navigation","navigate","orderDetail","userid","state","orderDtl","AsyncStorage","setItem","table","orderByField","listenerData","data","getOrderData","dataWait","result","val","promiseArr","Object","keys","map","key","index","Promise","push","allmem_barcode_pic","booking_by","booking_qty","booking_timestamp","booking_value","confirm_timestamp","firstname","invoice_pic","lastname","notification_flag","order_status","order_no","phone","product_code","reason_reject","all","then","setState","getItem","getOrder","Component","navigationOptions","title","styles","StyleSheet","create","container","height","flexDirection","marginTop","marginLeft","marginRight","borderRadius","contentLayout","flex","padding","iconLayout","justifyContent","alignItems"],"mappings":"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","sourcesContent":["import * as WebBrowser from 'expo-web-browser';\r\nimport React from 'react';\r\nimport {\r\n  Image,\r\n  Platform,\r\n  ScrollView,\r\n  StyleSheet,\r\n  Text,\r\n  TouchableOpacity,\r\n  TouchableHighlight,\r\n  View,\r\n  AsyncStorage,\r\n  FlatList,\r\n} from 'react-native';\r\n\r\nimport OrderHistoryCard from '../components/OrderHistoryCard';\r\nimport Lookup from '../helper/Lookup';\r\nimport FirebaseHelper from '../helper/FireBaseHelper';\r\nimport KeepAwake from 'expo-keep-awake';\r\nimport { resolve } from 'uri-js';\r\nimport {getLongCurrentTime} from '../components/CommonFunction'\r\n\r\n\r\n\r\nexport default class HistoryScreen extends React.Component {\r\n  constructor(props) {\r\n    super(props)\r\n    this.state={\r\n      orderDtl: [],\r\n      userid:'',\r\n    };\r\n    AsyncStorage.setItem('userid', '0635162877');\r\n    \r\n    /*let order = {\r\n      booking_timestamp: 0,\r\n      confirm: \"N\",\r\n      pic: \"\",\r\n      product_name: \"\",\r\n      transaction_url: \"\"\r\n    }\r\n    FirebaseHelper.writeUserData(\"store-00005/\",\"transaction/order-yyyyyyyyyy\", order) ; */\r\n  \r\n\r\n\r\n  }\r\n   getOrder(table,orderByField) {\r\n   \r\n    FirebaseHelper.listenerData(table,(data)=>{\r\n      this.getOrderData(data);\r\n    })      \r\n  }\r\n  getOrderData(dataWait){\r\n      //console.log(\"##### VIEW DATA IN LOOP########\");\r\n      //console.log(dataWait);\r\n      const result = [];\r\n      let data=dataWait.val();       \r\n      let promiseArr= Object.keys(data).map(function (key, index) {          \r\n        //console.log(\"##### VIEW KEY IN LOOP########\");\r\n       // console.log(key);\r\n        //console.log(data[key].product_code);\r\n        return new Promise(resolve => {            \r\n           resolve(\r\n            result.push({\r\n              allmem_barcode_pic: data[key].allmem_barcode_pic,\r\n              booking_by: data[key].booking_by,\r\n              booking_qty: data[key].booking_qty,\r\n              booking_timestamp: data[key].booking_timestamp,\r\n              booking_value: data[key].booking_value,\r\n              confirm_timestamp: data[key].confirm_timestamp,\r\n              firstname: data[key].firstname,\r\n              invoice_pic: data[key].invoice_pic,\r\n              lastname: data[key].lastname,\r\n              notification_flag: data[key].notification_flag,\r\n              order_status: data[key].order_status,\r\n              order_no:data[key].order_no,\r\n              phone: data[key].phone,\r\n              product_code: data[key].product_code,\r\n              reason_reject: data[key].reason_reject\r\n            })\r\n           )\r\n        })\r\n      });\r\n      Promise.all(promiseArr)\r\n      .then(()=>{ \r\n               this.setState({\r\n                 orderDtl:result\r\n               });\r\n               //console.log(\"############VIEW DATA LAST###################\");\r\n               //console.log(this.state.orderDtl);                 \r\n      });\r\n    }\r\n  \r\n\r\n  async componentDidMount() {\r\n    let userid = '';\r\n    userid=await  AsyncStorage.getItem('userid');\r\n     //console.log(\"############VIEW USERID###################\");\r\n     //console.log(userid);    \r\n    this.getOrder('tb_user/user-'+userid,\"booking_timestamp\");\r\n    this.setState({\r\n      userid:userid\r\n    });\r\n\r\n    //console.log(this.state.orderDtl);\r\n  }\r\n  _render=(item)=>{\r\n    //console.log(\"###### FECT ITEM ##########\");\r\n    //console.log(item.item);\r\n    \r\n    return(\r\n      <TouchableHighlight onPress={() => this.props.navigation.navigate(\"HistoryDetail\",\r\n      {\r\n        orderDetail:item.item,\r\n        userid:this.state.userid\r\n      })}>\r\n      <OrderHistoryCard\r\n        orderDetail={item.item} \r\n      />\r\n    </TouchableHighlight>      \r\n    )\r\n  }\r\n  render() {\r\n    return (      \r\n      <View>\r\n         <FlatList\r\n          data={this.state.orderDtl}\r\n          renderItem={this._render}         \r\n         />         \r\n      </View>\r\n    );\r\n  }\r\n}\r\n\r\nHistoryScreen.navigationOptions = {\r\n  title: 'ประวัติ',\r\n  //headerLeft: null\r\n  // header: null,\r\n  // tabBarVisible: false\r\n};\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    height: 105,\r\n    flexDirection: 'row',\r\n    marginTop: 10,\r\n    marginLeft: 10,\r\n    marginRight: 10,\r\n    borderRadius: 5\r\n  },\r\n  contentLayout: {\r\n    flex: 8,\r\n    padding: 5,\r\n  },\r\n  iconLayout: {\r\n    justifyContent: 'center',\r\n    alignItems: 'center',\r\n    padding: 20\r\n  }\r\n});"]},"metadata":{},"sourceType":"module"}